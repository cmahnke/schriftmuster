{{- $pages := .Pages -}}
{{- if .IsHome -}}
    {{- $pages = where (where .Site.Pages "Section" "post") "Path" "!=" "post" -}}
{{- end -}}

{{ $paginator := .Paginate (where $pages "Params.displayinlist" "!=" false) -}}
<main class="list">
    	{{- range $paginator.Pages -}}

            {{- $rotate := "" }}
            {{- range (seq 0 1) -}}
                {{- $rotate = printf "%s%d" $rotate (index (shuffle (seq 0 99)) 0) -}}
            {{- end -}}
            {{- $rotate = printf "%s%d.%s" (index (shuffle (slice "-" "")) 0) (index (shuffle (seq 0 1)) 0) $rotate -}}
            {{- $style := printf "transform: rotate(%sdeg);" $rotate -}}

            <div class="list-entry paper-curl-right" style="{{ $style | safeCSS }}">

            <!--    <div class="sheet paper-curl-right">-->
                {{- $context := path.Dir .File.Path -}}
                    <a class="post-link" href="{{ .Permalink }}">
                        <div class="date">
                            <span class="date">{{ partial "date.html" . }}</span>
                        </div>
                        <div class="post-header">
                            <h1 class='post-title'>{{ .CurrentSection.Title }}: {{ .Title }}</h1>
                        </div>

                        {{- $previewImg := "" -}}
                        {{- $imgLocation := "" -}}
                        {{- $class := "" -}}
                        {{- if eq .Params.type "font" -}}
                            {{- $imgName := "preview.png" -}}
                            {{- $imgLocation = path.Join $context $imgName -}}
                            {{- $previewImg = (.Resources.ByType "image").GetMatch $imgName -}}
                            {{- $class = "font" -}}
                        {{- else if eq .Params.type "book" -}}
                            {{- $imgName := "front" -}}
                            {{- $imgLocation = path.Join $context $imgName -}}
                            {{- $previewImg = (.Resources.ByType "image").GetMatch $imgName -}}

                            {{- $class = "book" -}}
                        {{- end -}}
        				{{- if eq $previewImg nil -}}
                            {{ errorf "Can't find image %s" $imgLocation }}
                        {{- end -}}

                        {{- if gt $previewImg.Width 800 -}}
                            {{- $previewImg = $previewImg.Resize "800x" -}}
                        {{- end -}}

                        <div class="preview {{ $class }}">
                            <img alt="{{ i18n "preview" }}" src="{{ $previewImg.RelPermalink }}">
                        </div>

                        <div class='post-summary'>
        					{{ .Summary }}
        					<div class="more">{{ i18n "readPost" }}</div>
            			</div>
                    </a>
            <!--    </div>-->
            </div>
        {{- end -}}

{{/*

        {{ partial "pagination.html" . }}


    {{ if or ($paginator.HasPrev) ($paginator.HasNext) -}}
    <div class="pagination">
      {{ if $paginator.HasPrev }}
        <a class="back-next" href="{{ $paginator.Prev.URL }}">{{ i18n "previous_page" }}</a>
      {{ end }}
      {{ if $paginator.HasNext }}
        <a class="back-next" href="{{ $paginator.Next.URL }}">{{ i18n "next_page" }}</a>
      {{ end }}
    </div>
    {{- end }}
*/}}
</main>
